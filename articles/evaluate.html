<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Evaluate projections • propop</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate projections">
</head>
<body>
<p>








  pkgdown/extra.scss

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/prepare_data.html">Prepare data</a></li>
    <li><a class="dropdown-item" href="../articles/project_single_region.html">Projections for a single region</a></li>
    <li><a class="dropdown-item" href="../articles/project_subregions.html">Projections for subregions</a></li>
    <li><a class="dropdown-item" href="../articles/evaluate.html">Evaluate projections</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/statistik-aargau/propop/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="evaluate_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="evaluate_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="evaluate_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="evaluate_files/datatables-binding-0.33/datatables.js"></script><link href="evaluate_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="evaluate_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="evaluate_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="evaluate_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="evaluate_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Evaluate projections</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/statistik-aargau/propop/blob/main/vignettes/evaluate.Rmd" class="external-link"><code>vignettes/evaluate.Rmd</code></a></small>
      <div class="d-none name"><code>evaluate.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statistik-aargau.github.io/propop">propop</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="evaluate-projections">Evaluate projections<a class="anchor" aria-label="anchor" href="#evaluate-projections"></a>
</h2>
<p><code>propop</code> provides a function to <strong>compare
projections against a benchmark</strong>. The benchmark can be the
actual (recorded) population development (i.e., official records in
population registry) or a base model (e.g., when testing alternative
models or when comparing against the official FSO forecast).</p>
<p>Evaluations can be carried out individually <strong>per observation
unit</strong> or like a summary statistics <strong>aggregated across all
observations</strong> (e.g., all years, demographic groups, spatial
units).</p>
<div class="section level3">
<h3 id="get-the-data">Get the data<a class="anchor" aria-label="anchor" href="#get-the-data"></a>
</h3>
<p>To run the evaluation function, we need some benchmark data and the
results from the projection. An interesting possibility is to compare
real, observed data to predicted data. Because FSO’s projection
scenarios have just been published, there aren’t any observed data
available yet.</p>
<p>This example therefore uses older data and parameters from the
previous FSO model. That is, we run a model with the population from
2018 as starting population and the <strong>population records</strong>
from 2019-2022 as benchmark data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_benchmark</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_population.html">get_population</a></span><span class="op">(</span></span>
<span>  number_fso <span class="op">=</span> <span class="st">"px-x-0102010000_101"</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>  spatial_units <span class="op">=</span> <span class="st">"- Aargau"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Get the parameters for the projection (note that these parameters
aren’t available anymore; i.e., this code will fail if you try it for
the year 2019-2050):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  year_first <span class="op">=</span> <span class="fl">2019</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2050</span>,</span>
<span>  spatial_units <span class="op">=</span> <span class="st">"Aargau"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Run the population projection for 2019-2022:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/propop.html">propop</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="va">data_parameters</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scen</span> <span class="op">==</span> <span class="st">"reference"</span><span class="op">)</span>,</span>
<span>  year_first <span class="op">=</span> <span class="fl">2019</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2050</span>,</span>
<span>  age_groups <span class="op">=</span> <span class="fl">101</span>,</span>
<span>  fert_first <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  fert_last <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  share_born_female <span class="op">=</span> <span class="fl">100</span> <span class="op">/</span> <span class="fl">205</span>,</span>
<span>  <span class="co"># population records from 2018 as starting point</span></span>
<span>  population <span class="op">=</span> <span class="va">data_benchmark</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span><span class="op">)</span>,</span>
<span>  subregional <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  binational <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluate-1-year-age-classes">Evaluate 1-year age classes<a class="anchor" aria-label="anchor" href="#evaluate-1-year-age-classes"></a>
</h3>
<div class="section level4">
<h4 id="evaluation-of-observation-units">Evaluation of observation units<a class="anchor" aria-label="anchor" href="#evaluation-of-observation-units"></a>
</h4>
<p>Let’s first compare the projected population growth against the
recorded population development (= benchmark) using one-year age classes
(default option). Make sure to provide matching data frames, especially
in terms of the year ranges and spatial units. To remove the starting
population (2018) from the projection results, you could also use
<code>drop_start_year = TRUE</code>.</p>
<p>As a result of <code><a href="../reference/prepare_evaluation.html">prepare_evaluation()</a></code>, you get the
recorded (<code>n_bench</code>) and projected (<code>n_proj</code>)
population for each demographic group and year as data frame columns
next to each other:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine and pre-process the data</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_evaluation.html">prepare_evaluation</a></span><span class="op">(</span></span>
<span>  <span class="co"># only keep years from projected period</span></span>
<span>  data_benchmark <span class="op">=</span> <span class="va">data_benchmark</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2018</span><span class="op">)</span>,</span>
<span>  n_benchmark <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  data_projected <span class="op">=</span> <span class="va">data_projected</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2018</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2022</span><span class="op">)</span>,</span>
<span>  n_projected <span class="op">=</span> <span class="st">"n_dec"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show combined data</span></span>
<span><span class="va">combined</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,616 × 7</span></span></span>
<span><span class="co">#&gt;     year spatial_unit nat   sex     age n_benchmark n_projected</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         0        <span style="text-decoration: underline;">2</span>622        <span style="text-decoration: underline;">2</span>510</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         1        <span style="text-decoration: underline;">2</span>593        <span style="text-decoration: underline;">2</span>551</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         2        <span style="text-decoration: underline;">2</span>635        <span style="text-decoration: underline;">2</span>631</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         3        <span style="text-decoration: underline;">2</span>596        <span style="text-decoration: underline;">2</span>609</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         4        <span style="text-decoration: underline;">2</span>683        <span style="text-decoration: underline;">2</span>670</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         5        <span style="text-decoration: underline;">2</span>737        <span style="text-decoration: underline;">2</span>738</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         6        <span style="text-decoration: underline;">2</span>636        <span style="text-decoration: underline;">2</span>633</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         7        <span style="text-decoration: underline;">2</span>609        <span style="text-decoration: underline;">2</span>594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         8        <span style="text-decoration: underline;">2</span>642        <span style="text-decoration: underline;">2</span>632</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>019 Aargau       ch    m         9        <span style="text-decoration: underline;">2</span>657        <span style="text-decoration: underline;">2</span>654</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,606 more rows</span></span></span></code></pre></div>
<p>Based on the difference between the observed and projected number of
people, <code><a href="../reference/compute_measures.html">compute_measures()</a></code> then calculates the error and
several performance metrics:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evaluation_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_measures.html">compute_measures</a></span><span class="op">(</span><span class="va">combined</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Warning message:</span></span></span>
<span><span class="co">#&gt; The following columns of the output have missing values:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">"pe"</span> and <span style="color: #0000BB;">"ape"</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Missing values are likely to lead to biased evaluation</span></span>
<span><span class="co">#&gt; measures that cannot be properly interpreted.</span></span>
<span></span>
<span><span class="co"># Create table</span></span>
<span><span class="va">evaluation_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># select demographic group</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">&amp;</span> <span class="va">nat</span> <span class="op">==</span> <span class="st">"ch"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">==</span> <span class="fl">27</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># round to two digits</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">pe</span><span class="op">:</span><span class="va">ape</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    filter <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="st">"caption-side: top; text-align: left; font-weight: bold"</span>,</span>
<span>      <span class="st">"Performance measures for projections with 1-year age classes for the</span></span>
<span><span class="st">      canton of Aargau 2019-2022; only one demographic group is displayed."</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold\">Performance measures for projections with 1-year age classes for the\n      canton of Aargau 2019-2022; only one demographic group is displayed.<\/caption>","data":[["1","2","3","4"],[2019,2020,2021,2022],["Aargau","Aargau","Aargau","Aargau"],["ch","ch","ch","ch"],["m","m","m","m"],[27,27,27,27],[3114,3026,2895,2859],[3113,3029,2905,2863],[-1,3,10,4],["-0.03","0.10","0.35","0.14"],["0.03","0.10","0.35","0.14"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>spatial_unit<\/th>\n      <th>nat<\/th>\n      <th>sex<\/th>\n      <th>age<\/th>\n      <th>n_benchmark<\/th>\n      <th>n_projected<\/th>\n      <th>error<\/th>\n      <th>pe<\/th>\n      <th>ape<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":[1,5,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"spatial_unit","targets":2},{"name":"nat","targets":3},{"name":"sex","targets":4},{"name":"age","targets":5},{"name":"n_benchmark","targets":6},{"name":"n_projected","targets":7},{"name":"error","targets":8},{"name":"pe","targets":9},{"name":"ape","targets":10}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="aggregated-evaluation">Aggregated evaluation<a class="anchor" aria-label="anchor" href="#aggregated-evaluation"></a>
</h4>
<p>To obtain summary statistics for the whole projection model, you can
use the <code><a href="../reference/aggregate_measures.html">aggregate_measures()</a></code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_measures.html">aggregate_measures</a></span><span class="op">(</span><span class="va">evaluation_1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># round to two digits</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">mpe</span><span class="op">:</span><span class="va">ape_under_5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="st">"caption-side: top; text-align: left; font-weight: bold"</span>,</span>
<span>      <span class="st">"Evaluation measures of projection with one-year age classes, aggregated </span></span>
<span><span class="st">      across all observations."</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">Warning message:</span></span></span>
<span><span class="co">#&gt; The following columns in `data` have missing values:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> <span style="color: #0000BB;">"pe"</span> and <span style="color: #0000BB;">"ape"</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Missing values may lead to inaccurate evaluation</span></span>
<span><span class="co">#&gt; measures.</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold\">Evaluation measures of projection with one-year age classes, aggregated \n      across all observations.<\/caption>","data":[["1"],["2.18"],["0.30"],["4.08"],["1.16"],["30.90"],["1616.00"],["0.45"],["0.85"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mpe<\/th>\n      <th>medpe<\/th>\n      <th>mape<\/th>\n      <th>medape<\/th>\n      <th>rmse<\/th>\n      <th>n_measure<\/th>\n      <th>ape_under_1<\/th>\n      <th>ape_under_5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"mpe","targets":1},{"name":"medpe","targets":2},{"name":"mape","targets":3},{"name":"medape","targets":4},{"name":"rmse","targets":5},{"name":"n_measure","targets":6},{"name":"ape_under_1","targets":7},{"name":"ape_under_5","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level3">
<h3 id="evaluate-larger-age-groups">Evaluate larger age groups<a class="anchor" aria-label="anchor" href="#evaluate-larger-age-groups"></a>
</h3>
<p>One-year age classes often lead to small group sizes. This is
particularly problematic when the benchmark is equal to 0; then some
measures may be inaccurate.</p>
<p>A solution to this problem is to use larger age groups that contain
several years.</p>
<div class="section level4">
<h4 id="evaluation-of-observation-units-1">Evaluation of observation units<a class="anchor" aria-label="anchor" href="#evaluation-of-observation-units-1"></a>
</h4>
<p>Instead of using one-year age classes, you can conduct the evaluation
for the commonly used age groups 0-19 year olds, 20-64 year olds, and
over 64 year olds using the option
<code>age_groups = "age_groups_3"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine and pre-process the data</span></span>
<span><span class="va">combined_grouped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_evaluation.html">prepare_evaluation</a></span><span class="op">(</span></span>
<span>  <span class="co"># only keep years from projected period</span></span>
<span>  data_benchmark <span class="op">=</span> <span class="va">data_benchmark</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2018</span><span class="op">)</span>,</span>
<span>  n_benchmark <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  data_projected <span class="op">=</span> <span class="va">data_projected</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2018</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2022</span><span class="op">)</span>,</span>
<span>  age_groups <span class="op">=</span> <span class="st">"age_groups_3"</span>,</span>
<span>  n_projected <span class="op">=</span> <span class="st">"n_dec"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show combined data</span></span>
<span><span class="va">combined_grouped</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 48 × 7</span></span></span>
<span><span class="co">#&gt;     year spatial_unit age         sex   nat   n_benchmark n_projected</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_00_19   f     ch          <span style="text-decoration: underline;">49</span>279       <span style="text-decoration: underline;">49</span>129</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_00_19   f     int         <span style="text-decoration: underline;">17</span>818       <span style="text-decoration: underline;">18</span>118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_00_19   m     ch          <span style="text-decoration: underline;">52</span>389       <span style="text-decoration: underline;">52</span>076</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_00_19   m     int         <span style="text-decoration: underline;">19</span>323       <span style="text-decoration: underline;">19</span>566</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_20_64   f     ch         <span style="text-decoration: underline;">151</span>860      <span style="text-decoration: underline;">151</span>781</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_20_64   f     int         <span style="text-decoration: underline;">56</span>115       <span style="text-decoration: underline;">56</span>380</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_20_64   m     ch         <span style="text-decoration: underline;">149</span>279      <span style="text-decoration: underline;">149</span>263</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_20_64   m     int         <span style="text-decoration: underline;">66</span>770       <span style="text-decoration: underline;">67</span>029</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_65_plus f     ch          <span style="text-decoration: underline;">59</span>729       <span style="text-decoration: underline;">59</span>847</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>019 Aargau       age_65_plus f     int          <span style="text-decoration: underline;">6</span>311        <span style="text-decoration: underline;">6</span>332</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 38 more rows</span></span></span>
<span></span>
<span><span class="co"># Compute the performance measures</span></span>
<span><span class="va">evaluation_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_measures.html">compute_measures</a></span><span class="op">(</span><span class="va">combined_grouped</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">evaluation_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># select demographic group</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">&amp;</span> <span class="va">nat</span> <span class="op">==</span> <span class="st">"ch"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">==</span> <span class="st">"age_20_64"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># round to two digits</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">pe</span><span class="op">:</span><span class="va">ape</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="st">"caption-side: top; text-align: left; font-weight: bold"</span>,</span>
<span>      <span class="st">"Performance measures for projections with three age classes for the</span></span>
<span><span class="st">      canton of Aargau 2019-2022; only one demographic group is displayed."</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold\">Performance measures for projections with three age classes for the\n      canton of Aargau 2019-2022; only one demographic group is displayed.<\/caption>","data":[["1","2","3","4"],[2019,2020,2021,2022],["Aargau","Aargau","Aargau","Aargau"],["age_20_64","age_20_64","age_20_64","age_20_64"],["m","m","m","m"],["ch","ch","ch","ch"],[149279,149723,149718,149489],[149263,149453,149393,149260],[-16,-270,-325,-229],["-0.01","-0.18","-0.22","-0.15"],["0.01","0.18","0.22","0.15"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>spatial_unit<\/th>\n      <th>age<\/th>\n      <th>sex<\/th>\n      <th>nat<\/th>\n      <th>n_benchmark<\/th>\n      <th>n_projected<\/th>\n      <th>error<\/th>\n      <th>pe<\/th>\n      <th>ape<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":[1,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"spatial_unit","targets":2},{"name":"age","targets":3},{"name":"sex","targets":4},{"name":"nat","targets":5},{"name":"n_benchmark","targets":6},{"name":"n_projected","targets":7},{"name":"error","targets":8},{"name":"pe","targets":9},{"name":"ape","targets":10}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="aggregated-evaluation-1">Aggregated evaluation<a class="anchor" aria-label="anchor" href="#aggregated-evaluation-1"></a>
</h4>
<p>You can again use <code><a href="../reference/aggregate_measures.html">aggregate_measures()</a></code> to obtain a
summary of the evaluation across all observations:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_measures.html">aggregate_measures</a></span><span class="op">(</span><span class="va">evaluation_2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># round to two digits</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">mpe</span><span class="op">:</span><span class="va">ape_under_5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="st">"caption-side: top; text-align: left; font-weight: bold"</span>,</span>
<span>      <span class="st">"Evaluation measures for projection with three age classes, aggregated </span></span>
<span><span class="st">      across all observations."</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold\">Evaluation measures for projection with three age classes, aggregated \n      across all observations.<\/caption>","data":[["1"],["0.83"],["0.40"],["1.27"],["0.94"],["475.81"],["48.00"],["0.52"],["0.98"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mpe<\/th>\n      <th>medpe<\/th>\n      <th>mape<\/th>\n      <th>medape<\/th>\n      <th>rmse<\/th>\n      <th>n_measure<\/th>\n      <th>ape_under_1<\/th>\n      <th>ape_under_5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"mpe","targets":1},{"name":"medpe","targets":2},{"name":"mape","targets":3},{"name":"medape","targets":4},{"name":"rmse","targets":5},{"name":"n_measure","targets":6},{"name":"ape_under_1","targets":7},{"name":"ape_under_5","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level3">
<h3 id="using-group-weights">Using group weights<a class="anchor" aria-label="anchor" href="#using-group-weights"></a>
</h3>
<div class="section level4">
<h4 id="evaluation-of-observation-units-2">Evaluation of observation units<a class="anchor" aria-label="anchor" href="#evaluation-of-observation-units-2"></a>
</h4>
<p>Furthermore, you can use weights. When using the weighted metric,
adjusted absolute percentage errors weigh less heavily in smaller groups
than in larger groups. The adjusted metric <code>w_ape</code> considers
that smaller groups tend to have larger forecast errors.</p>
<p>This is illustrated in the following table: The unweigthed percentage
errors (<code>ape</code>) 0.39/0.36 become 0.24/0.07 when they are
weighted by the total number of people per group
(<code>w_ape</code>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evaluation_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_measures.html">compute_measures</a></span><span class="op">(</span><span class="va">combined_grouped</span>, weight_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">evaluation_3</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2019</span> <span class="op">&amp;</span> <span class="va">ape</span> <span class="op">&gt;</span> <span class="fl">.34</span> <span class="op">&amp;</span> <span class="va">ape</span> <span class="op">&lt;</span> <span class="fl">.39</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">pe</span><span class="op">:</span><span class="va">w_ape</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="st">"caption-side: top; text-align: left; font-weight: bold"</span>,</span>
<span>      <span class="st">"Selected results showing the effect of using weights </span></span>
<span><span class="st">      (ape versus w_ape)."</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatStyle</a></span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ape'</span>, <span class="st">'w_ape'</span><span class="op">)</span>,</span>
<span>    backgroundColor <span class="op">=</span> <span class="st">'#96D4FF'</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1fb4450895fe099f74a1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold\">Selected results showing the effect of using weights \n      (ape versus w_ape).<\/caption>","data":[["1","2"],[2019,2019],["Aargau","Aargau"],["age_20_64","age_65_plus"],["m","m"],["int","ch"],[66770,49814],[67029,49992],[259,178],["0.39","0.36"],["0.39","0.36"],["2794235.00","2794235.00"],["1715303.00","511810.00"],["0.61","0.18"],["0.24","0.07"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>spatial_unit<\/th>\n      <th>age<\/th>\n      <th>sex<\/th>\n      <th>nat<\/th>\n      <th>n_benchmark<\/th>\n      <th>n_projected<\/th>\n      <th>error<\/th>\n      <th>pe<\/th>\n      <th>ape<\/th>\n      <th>n_tot<\/th>\n      <th>group_tot<\/th>\n      <th>weight<\/th>\n      <th>w_ape<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":[1,6,7,8]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"spatial_unit","targets":2},{"name":"age","targets":3},{"name":"sex","targets":4},{"name":"nat","targets":5},{"name":"n_benchmark","targets":6},{"name":"n_projected","targets":7},{"name":"error","targets":8},{"name":"pe","targets":9},{"name":"ape","targets":10},{"name":"n_tot","targets":11},{"name":"group_tot","targets":12},{"name":"weight","targets":13},{"name":"w_ape","targets":14}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[10]; $(this.api().cell(row, 10).node()).css({'background-color':'#96D4FF'});\nvar value=data[14]; $(this.api().cell(row, 14).node()).css({'background-color':'#96D4FF'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="aggregated-evaluation-2">Aggregated evaluation<a class="anchor" aria-label="anchor" href="#aggregated-evaluation-2"></a>
</h4>
<p>You can also use <code><a href="../reference/aggregate_measures.html">aggregate_measures()</a></code> to obtain a
summary of the evaluation with weighted groups:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aggregate_measures.html">aggregate_measures</a></span><span class="op">(</span><span class="va">evaluation_3</span>, weight_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># round to two digits</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">mpe</span><span class="op">:</span><span class="va">ape_under_5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">'t'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-10b3b7155e8045a1b2ad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["age_00_19","age_20_64","age_65_plus"],["0.77","-0.01","1.73"],["0.48","-0.11","1.29"],["1.80","0.26","1.73"],["1.70","0.26","1.29"],["5.85","2.59","5.07"],["562.85","287.00","529.17"],["16.00","16.00","16.00"],["0.19","1.00","0.38"],["1.00","1.00","0.94"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>age<\/th>\n      <th>mpe<\/th>\n      <th>medpe<\/th>\n      <th>mape<\/th>\n      <th>medape<\/th>\n      <th>wmape<\/th>\n      <th>rmse<\/th>\n      <th>n_measure<\/th>\n      <th>ape_under_1<\/th>\n      <th>ape_under_5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"age","targets":1},{"name":"mpe","targets":2},{"name":"medpe","targets":3},{"name":"mape","targets":4},{"name":"medape","targets":5},{"name":"wmape","targets":6},{"name":"rmse","targets":7},{"name":"n_measure","targets":8},{"name":"ape_under_1","targets":9},{"name":"ape_under_5","targets":10}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><!-- ## `propop` versus FSO --><!-- Instead of comparing the propop projection with population records, we can also --><!-- use the evaluation function to check how close the `propop` projection comes to --><!-- FSO's projection from the 2020 model. --><!-- In the example data, the differences are extremely small (>= 1): --><!-- ``` {r fso-comparison} --><!-- fso_propop <- prepare_evaluation( --><!--   data_benchmark = data_parameters |> --><!--     dplyr::filter(scen == "reference" & year > 2018) |> --><!--     dplyr::mutate(n = fso_projection_n), --><!--   n_benchmark = "n", --><!--   data_projected = data_projected |> --><!--     dplyr::filter(year > 2018), --><!--   age_groups = "age_groups_3", --><!--   n_projected = "n_dec" --><!-- ) |> --><!--   compute_measures() --><!-- fso_propop |> --><!--   dplyr::mutate(across(pe:ape, \(x) sprintf(fmt = "%.3f", x))) |> --><!--   DT::datatable( --><!--     filter = "top", --><!--     caption = htmltools::tags$caption( --><!--       style = "caption-side: top; text-align: left; font-weight: bold", --><!--       "Comparison of projetions from FSO versus `propop`." --><!--     ) --><!--   ) --><!-- ``` --><!-- ```{r fig.width = 9, fig.height = 7, echo = FALSE} --><!-- library(ggplot2) --><!-- add_percent <- function(x) { --><!--   paste0(x, "%") --><!-- } --><!-- ggplot(fso_propop) + --><!--   geom_jitter(aes(x = year, y = pe), size = 0.7) + --><!--   labs( --><!--     title = "Differences between FSO and propop projections for each demographic group (2019-2050)", --><!--     x = "Year", --><!--     y = "Difference in percent" --><!--   ) + --><!--   scale_y_continuous(labels = add_percent) + --><!--   theme_minimal() --><!-- ``` -->
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Norah Efosa, Adrian Gadient, Tina Cornioley, Jan Wunder, Niklas Haffert, Statistik Aargau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  
</body>
</html>
