test_that("snapshot test complement_projection()", {

  skip_on_ci()

  # create skeleton with variable labels and levels
  # prepare_skeleton(
  #   age_groups = 101,
  #   year_first = 2024,
  #   year_last = 2024,
  #   spatial_unit = "Canton"
  # ) |>
  #   constructive::construct()

  empty_df <- tibble::tibble(
    age = rep(0:100, 8),
    sex = factor(rep(rep(c("m", "f"), 4), each = 101L), levels = c("m", "f")),
    nat = factor(rep(rep(c("ch", "int"), 2), each = 202L)),
    year = rep(2023:2024, each = 404L),
    spatial_unit = factor(rep("Canton", 808L)),
  ) |>
    structure(
      out.attrs = list(
        dim = c(age = 101L, sex = 2L, nat = 2L, year = 2L, spatial_unit = 1L),
        dimnames = list(
          age = c(
            "age=  0", "age=  1", "age=  2", "age=  3", "age=  4", "age=  5", "age=  6",
            "age=  7", "age=  8", "age=  9", "age= 10", "age= 11", "age= 12", "age= 13",
            "age= 14", "age= 15", "age= 16", "age= 17", "age= 18", "age= 19", "age= 20",
            "age= 21", "age= 22", "age= 23", "age= 24", "age= 25", "age= 26", "age= 27",
            "age= 28", "age= 29", "age= 30", "age= 31", "age= 32", "age= 33", "age= 34",
            "age= 35", "age= 36", "age= 37", "age= 38", "age= 39", "age= 40", "age= 41",
            "age= 42", "age= 43", "age= 44", "age= 45", "age= 46", "age= 47", "age= 48",
            "age= 49", "age= 50", "age= 51", "age= 52", "age= 53", "age= 54", "age= 55",
            "age= 56", "age= 57", "age= 58", "age= 59", "age= 60", "age= 61", "age= 62",
            "age= 63", "age= 64", "age= 65", "age= 66", "age= 67", "age= 68", "age= 69",
            "age= 70", "age= 71", "age= 72", "age= 73", "age= 74", "age= 75", "age= 76",
            "age= 77", "age= 78", "age= 79", "age= 80", "age= 81", "age= 82", "age= 83",
            "age= 84", "age= 85", "age= 86", "age= 87", "age= 88", "age= 89", "age= 90",
            "age= 91", "age= 92", "age= 93", "age= 94", "age= 95", "age= 96", "age= 97",
            "age= 98", "age= 99", "age=100"
          ),
          sex = c("sex=m", "sex=f"),
          nat = c("nat=ch", "nat=int"),
          year = c("year=2023", "year=2024"),
          spatial_unit = "spatial_unit=Canton"
        )
      )
    )

  # # create df with raw projection results
  # project_raw(
  #   parameters = fso_parameters |>
  #     dplyr::filter(year == 2025 &
  #                     scen == "reference"),
  #   year_first = 2025,
  #   year_last = 2025,
  #   age_groups = 101,
  #   fert_first = 16,
  #   fert_last = 50,
  #   share_born_female = 100 / 205,
  #   n = fso_population |> dplyr::pull(n),
  #   subregional = FALSE
  # ) |>
  #   constructive::construct()

  raw_df <- data.frame(
    N = c(
      2461, 2481, 2452, 2595, 2935, 2804, 2827, 2814, 2816, 2760, 2869, 2901, 2799,
      2812, 2847, 2872, 2759, 2823, 2705, 2781, 2767, 2764, 2724, 2683, 2637, 2859,
      2793, 2851, 2880, 3042, 2830, 2865, 3109, 3225, 3212, 3248, 3250, 3254, 3220,
      3315, 3186, 3331, 3308, 3344, 3311, 3327, 3169, 3124, 3119, 2960, 3035, 3218,
      3263, 3392, 3569, 3717, 3781, 4030, 4102, 4129, 4220, 4267, 4053, 4020, 3889,
      3689, 3562, 3417, 3387, 3245, 3182, 3016, 2937, 2822, 2598, 2624, 2500, 2523,
      2419, 2334, 2169, 2031, 1908, 1624, 1461, 1119, 1012, 965, 820, 659, 600, 505,
      378, 326, 247, 187, 119, 88, 54, 24, 45, 2356, 2371, 2344, 2477, 2728, 2570,
      2608, 2637, 2697, 2687, 2670, 2631, 2613, 2690, 2638, 2809, 2628, 2729, 2595,
      2602, 2561, 2636, 2582, 2554, 2541, 2654, 2752, 2715, 2834, 2865, 2896, 2961,
      2967, 3223, 3222, 3324, 3213, 3330, 3301, 3307, 3250, 3348, 3327, 3426, 3451,
      3314, 3258, 3067, 3164, 3329, 3204, 3209, 3260, 3426, 3738, 3873, 3911, 4209,
      4202, 4300, 4280, 4390, 4286, 4131, 4040, 3922, 3730, 3711, 3694, 3500, 3399,
      3244, 3139, 3131, 2915, 2925, 2819, 2734, 2665, 2623, 2503, 2404, 2312, 2025,
      1795, 1562, 1471, 1340, 1178, 1147, 951, 862, 697, 609, 463, 381, 296, 218,
      150, 106, 162, 1197, 1173, 994, 1127, 1165, 1149, 1170, 1199, 1160, 1238,
      1135, 1172, 1121, 1155, 1103, 1002, 994, 1062, 952, 1074, 1089, 1010, 974,
      1029, 1069, 1254, 1334, 1482, 1627, 1742, 1754, 1882, 2006, 2060, 2174, 2305,
      2259, 2228, 2352, 2299, 2295, 2353, 2246, 2274, 2248, 2185, 2094, 2055, 1932,
      1882, 1785, 1729, 1687, 1690, 1588, 1537, 1557, 1512, 1506, 1473, 1468, 1378,
      1247, 1104, 986, 961, 756, 709, 610, 578, 554, 483, 419, 392, 386, 427, 346,
      357, 303, 299, 233, 269, 253, 262, 199, 223, 191, 155, 109, 112, 83, 50, 33,
      15, 13, 8, 11, 5, 2, 0, 0, 1152, 1127, 987, 994, 1113, 1155, 1106, 1089, 1062,
      1136, 1071, 1091, 1024, 1031, 926, 1002, 934, 896, 861, 792, 826, 811, 803,
      843, 901, 1041, 1132, 1269, 1422, 1491, 1614, 1663, 1750, 1863, 1869, 1968,
      1956, 1993, 1993, 2007, 2015, 1981, 1972, 1987, 1913, 1872, 1716, 1774, 1635,
      1546, 1566, 1486, 1396, 1479, 1391, 1282, 1298, 1213, 1208, 1161, 1055, 1068,
      955, 853, 801, 797, 683, 629, 534, 505, 510, 492, 438, 397, 378, 369, 354,
      368, 259, 286, 225, 234, 194, 226, 200, 215, 195, 147, 140, 86, 84, 53, 52,
      29, 24, 17, 17, 10, 7, 3, 4, 2436.848405157811, 2525.83377948869,
      2530.741399919048, 2497.4905949469344, 2638.277899, 2965.9617649999996,
      2834.0171549999995, 2855.340962, 2845.762968, 2847.7717920000005, 2797.5671,
      2908.212763, 2944.909963, 2848.7880959999998, 2868.4122650000004, 2902.561106,
      2921.70740682734, 2805.4284458575653, 2856.920613792984, 2711.6449816632376,
      2779.4411386773195, 2762.165549335083, 2757.063773813248, 2715.555579583846,
      2673.1976913627996, 2629.1178110031665, 2832.2063851380817,
      2776.5245521803677, 2841.7731018620616, 2885.058271065066, 3049.8612762550397,
      2865.869756507249, 2911.66123629344, 3158.585197981756, 3278.499864821875,
      3269.9690882589402, 3304.5507702987998, 3306.4657459437244,
      3307.5635185842643, 3274.013080019534, 3363.0981466299404, 3237.3330956039918,
      3375.0526818363874, 3350.307456312864, 3381.7558373557, 3349.1671070853436,
      3359.519688044615, 3200.801826846431, 3156.628476255962, 3146.14309877452,
      2988.3480027039054, 3060.5140171249604, 3240.180317355612, 3281.9731428540003,
      3408.8048001800216, 3579.8650282954923, 3721.829738644684, 3781.53848960783,
      4023.2903876255195, 4092.725013489885, 4116.6033308686965, 4203.467557289683,
      4246.1911702654525, 4034.331310029805, 3992.17720339688, 3836.974211701726,
      3660.6842914053004, 3532.561558694716, 3383.909428209173, 3348.392815929653,
      3204.852930189235, 3139.980368632982, 2971.4761272771552, 2890.5312991186,
      2771.751486445372, 2546.551653104792, 2565.79807469594, 2436.646243107368,
      2449.63342686103, 2337.714850406402, 2244.11198178066, 2070.9923756073654,
      1927.209087576965, 1792.818054157328, 1513.1654239665042, 1345.9123369706658,
      1017.9505939822416, 909.0192509040199, 856.0360042129125, 717.26361568055,
      569.7452892135955, 511.71592158000004, 424.20672074963, 310.59514616298196,
      262.34642509368405, 192.547008961978, 141.42866099999998, 86.54548700000001,
      61.925952, 36.000018, 42.93331800000001, 2324.9642927396108,
      2402.004035226556, 2416.932733727887, 2386.0635582886002, 2518.137165,
      2755.577712, 2600.306035, 2635.65613, 2663.151948, 2725.275262,
      2718.4240929999996, 2705.101561, 2668.0270250000003, 2653.2792289999998,
      2735.182237, 2683.515672, 2857.9749229999998, 2673.902658, 2768.624469,
      2627.765154, 2626.56594, 2576.6991740000003, 2632.1767149999996, 2574.282572,
      2542.9557205, 2542.0028450556456, 2646.9644137654795, 2740.7485611737284,
      2716.8019093072267, 2843.598831946216, 2881.93930851816, 2926.107046680016,
      3004.2937112869804, 3024.306724652688, 3279.880966199874, 3286.761002984448,
      3388.10904910428, 3281.269795674968, 3391.3606741533004, 3363.8632482519347,
      3365.7912639748406, 3306.32832714808, 3396.8040700061, 3371.3312504814194,
      3463.660855859264, 3485.6687383779995, 3344.7939118332274, 3283.2531616914,
      3091.470955275368, 3185.746152787143, 3344.88754634561, 3224.142232076526,
      3227.9107310797767, 3276.4486284142504, 3440.6103978936812,
      3743.0735710940558, 3876.403556995622, 3911.1516568142, 4202.930930000164,
      4195.751575495832, 4292.398434576069, 4270.549413615475, 4376.031663534692,
      4271.186063610791, 4104.613888635872, 4015.0812994803055, 3900.4953479929763,
      3707.8881058433994, 3683.9171315312506, 3665.2307634752638,
      3470.4949129440697, 3366.59494299936, 3212.4460378802078, 3103.854264759538,
      3090.142648452375, 2875.1729889860403, 2878.8123485425, 2771.1217106828376,
      2681.326871840962, 2605.862923898, 2556.435903949725, 2428.6470041871357,
      2322.4769604069243, 2221.662977586068, 1932.5861174125, 1699.5691001095427,
      1462.853531262178, 1362.8166452069427, 1223.2809481926802, 1060.74891706108,
      1013.5198105761134, 824.8095722514, 732.6959623690701, 578.832803943784,
      493.9720967192, 364.364586647125, 293.20743849999997, 220.997272, 156.96,
      104.71695, 173.1661745, 1132.5392631566133, 1197.240032505348, 1174.933935,
      1011.025022, 1141.0552209999998, 1175.191965, 1162.9878079999999, 1184.28132,
      1212.351842, 1174.2753599999999, 1244.551826, 1142.67303, 1172.5890120000001,
      1118.737078, 1144.171465, 1092.4311050000001, 994.5431603660419,
      989.0301270426999, 1062.421292379024, 982.4721900867199, 1109.932516149275,
      1136.059388850786, 1075.79154417468, 1063.3974516825222, 1131.276024848878,
      1191.4993197130689, 1376.878371338535, 1464.2771487840498, 1610.68277296424,
      1750.142027149912, 1861.2217742678731, 1876.513798854084, 1997.61873592972,
      2109.903843327802, 2157.90935166081, 2258.136274077102, 2372.25362621241,
      2326.539260884805, 2285.643654724714, 2394.0120244316404, 2337.6640729279284,
      2321.208870691055, 2366.380358777892, 2260.941806120342, 2279.228533603176,
      2249.7860905790803, 2183.0893913842847, 2091.49229892306, 2049.26693012139,
      1928.942107288218, 1877.295376454277, 1781.7606131746902, 1722.6361123578424,
      1680.1582890443685, 1678.542928504115, 1576.2919828918723, 1521.0614527374698,
      1531.5408342687958, 1479.6691779192, 1474.26049862872, 1432.7206613455473,
      1435.8168700293402, 1338.37956574016, 1203.085351927215, 1049.987339071872,
      913.653909354927, 902.003850750888, 734.872882447706, 691.110815887291,
      596.830219007015, 562.09262208682, 540.5007225714239, 469.7115121771265,
      408.032318909929, 379.76683006518, 374.530199753392, 413.961767169738,
      335.428627450065, 345.863111285811, 292.82676348394045, 285.886392834608,
      222.7366621643325, 257.238795597847, 241.444162212565, 249.83710314515,
      188.391608654296, 207.82193161148797, 174.98055561322, 139.35782864351,
      96.3482046343015, 94.45780074304, 68.06, 39.39395, 24.199989000000002,
      11.538465, 8.125, 5.090911999999999, 6.6, 2.5, 2, 0, 1090.104540547667,
      1166.203641991104, 1137.638637, 1006.421719, 1012.735624, 1124.1829890000001,
      1164.6524, 1118.234424, 1099.831054, 1070.257132, 1136.026864,
      1068.9897839999999, 1082.596838, 1012.387136, 1010.650275, 904.93038,
      973.486238, 909.412346, 874.479936, 852.684919, 806.963736, 861.57543,
      872.1734180000001, 888.41304, 948.308576, 1020.1050929999999,
      1160.488182342177, 1257.2786051641958, 1392.8744705987908, 1534.018712210823,
      1596.206334122355, 1700.918452651875, 1742.71188952044, 1817.245998368,
      1915.418386736472, 1915.6375951112275, 2002.2346185058718, 1987.24705191924,
      2016.9998639002001, 2009.78776190252, 2019.4314808685351, 2022.2142860133201,
      1982.538684225285, 1970.7400671816858, 1982.4416158761844, 1908.0726560714538,
      1864.7280503841441, 1714.6135955691839, 1769.9418688050412, 1634.14538729324,
      1546.8397560564122, 1563.6608254318949, 1485.3294070435102,
      1397.3075786001439, 1474.582154037516, 1386.7336466959646, 1271.674954156118,
      1279.148315444766, 1190.7625207427889, 1179.7295380624398, 1128.5666311696382,
      1027.6522360396, 1038.675699180336, 928.3277854239025, 822.2109059025951,
      783.83890675681, 782.164065179551, 672.3753968469425, 621.6894447920035,
      529.3052502988221, 498.12601683992006, 502.558772656025, 484.64483542687805,
      431.96842493700797, 391.54255653176796, 371.75547953055, 362.573311538432,
      347.411098785973, 359.22519494128005, 253.031796243276, 277.564059896192,
      218.37517122600002, 227.353253907744, 186.68491302003102, 217.691121,
      190.8936661288, 202.66097615320004, 181.0931439651625, 134.34485280591298,
      126.37100550107999, 76.75068260884501, 72.34852862620002, 44.817602729289,
      41.241347238962, 22.9583178435295, 18.352944, 13.000002, 11.899999999999999,
      7.14286, 4.666669, 5.25
    ),
    BIRTHS = rep(
      c(
        2413.2045187478, 0, 2298.290017855047, 0, 1116.7979273117483, 0,
        1063.617073630237, 0, NA
      ),
      c(1L, 100L, 1L, 100L, 1L, 100L, 1L, 100L, 404L)
    ),
    MOR = rep(
      c(
        7.838481709816941, 0.9929105113100002, 1.011476080952, 0.9285310530659999, 0,
        0.003949, 1.04007317266, 0.9769241424350001, 1.045185207016,
        0.9724933367624999, 1.0038623226805001, 1.001107664917, 1.0135381867520001,
        1.0150164161539998, 1.0161886372, 0.9249059968335, 1.0212578619185,
        0.980104819632, 0.989185137938, 0.9504519349335, 1.07193374496,
        0.9861094927509999, 0.94942970656, 1.931095018244, 2.0063851781250004,
        1.9776037410599998, 1.9990697011999996, 1.9974930562754998, 2.020623415736,
        1.9467879804660002, 2.0796063700595, 1.9283003960079996, 3.0220431636125,
        2.9679356871360003, 3.0278166442999996, 2.996764914656, 4.198965955385001,
        4.057016153569499, 4.0173967440375, 5.26609822548, 4.884207296095,
        5.66903787504, 6.910173644388, 7.703577146, 8.570553819977999,
        10.579554704508, 12.790404355316499, 14.091530392169998, 16.71027637448,
        17.898412510115005, 20.559433131304004, 22.756578710316, 24.2197747345475,
        25.215831970194003, 26.88863660312, 28.466120298274, 29.0094985947,
        30.238843305284, 32.293617790827, 34.448165070347, 35.699824810765,
        37.991389367017995, 41.083937722845, 43.72305088139999, 47.797017554628006,
        49.522514895208, 56.69195530406, 61.460402892632004, 71.98607113897,
        79.824551593598, 88.25963821933999, 96.126381392634, 103.27404242303501,
        112.78313784267199, 110.05399203349602, 113.558454029334, 99.52042701775851,
        101.73757709598001, 108.2557607870875, 103.24768431945, 90.05826378640451,
        87.90807842000001, 81.45704925037, 67.24552783701799, 63.333600906316,
        54.132035038021996, 45.571339, 32.454513, 26.074048, 17.999982, 26.066682,
        6.860263802138404, 0.994880773444, 1.0118152721135, 0.9299987114, 0,
        0.0314795, 0.9570719443545, 0.9654462345200001, 1.0120148262720001,
        0.9583896927735001, 0.9876840537839999, 0.9879114818400001,
        0.9781913199840001, 0.99711271302, 0.9228033473119999, 1.0008528001260002,
        0.9706450155520001, 1.03313089572, 0.9647163250319999, 1.0083038466999998,
        1.0113207480655, 2.0350480251599996, 1.9414428519199998, 2.0133299939,
        1.94295151858, 1.9854661407360001, 2.090001622, 3.0525221667720004,
        3.1832383086000005, 2.9168217246325003, 3.8067902128570004, 4.15369865439,
        4.000961923474, 4.923042920223, 4.76867158575, 6.427704106319,
        7.724204905943999, 7.9322280043775, 9.301743185799998, 11.021286999836,
        11.732830504166998, 13.07220042393, 14.632656384525, 16.396774465308003,
        17.6417453892085, 18.410495364128, 19.578704519694, 21.034220007024,
        22.120044156600002, 24.120243468749997, 26.387524524735998, 26.78189205593,
        29.342977000639994, 31.009674119792, 33.093803240462, 36.523426547625,
        37.88503101396, 43.5882764575, 47.4421903171625, 52.33667615903801,
        58.944701102, 66.036011050275, 72.899267812864, 81.123335593076,
        90.20231041393203, 92.51638258750002, 96.5363048904575, 98.77507073782199,
        109.79241979305749, 117.16841180732, 119.16943493891999, 135.0680484238865,
        127.9841077486, 131.06706763093, 119.02272205621601, 115.71246328080002,
        98.42003835287501, 88.7925615, 76.002728, 61.040000000000006, 45.28305,
        95.83382549999999, 3.8381034626297157, 0.980871494652, 0,
        0.025224999999999997, 1.006163633958, 0.9401529573000001, 1.1076196209759999,
        0.88957791328, 0.989633850725, 1.0747381492139998, 1.0294958253199997,
        0.9472803174780001, 0.952501151122, 0.8604372869310001, 0.9370986614650001,
        0.9019772159499999, 0.9133070357599998, 0.938368850088, 0.987779732127,
        0.9325031459159999, 0.94122407028, 0.972410672198, 0.94802833919,
        0.947673922898, 1.02062878759, 1.011034115195, 0.9514772752859999,
        1.02309556836, 1.044594072072, 1.9573443089449998, 2.090797222108,
        1.978101879658, 2.024612396824, 2.0594694209199997, 2.085903615715,
        2.04126107694, 2.1573998786099997, 3.082640711782, 3.161497545723,
        3.0973168253099996, 3.0728726421575, 2.9992299556315003, 3.1905414958850002,
        3.120193108128, 3.9527042625299993, 4.136649731203999, 5.0213180808,
        5.12622137128, 6.0252416544525005, 6.3950099706599985, 6.63205425984,
        6.790355072785, 7.832052928128, 7.1862566450730005, 7.624283249112,
        7.469801552294, 8.130063112709003, 7.394970992985001, 8.34460791318,
        8.029261428576, 8.066568822873498, 7.485598090071, 8.124249934820002,
        8.141716246608, 9.867655830261999, 8.725642549935, 9.424131714189,
        9.120005516059502, 8.980375165392, 7.798860835667501, 9.571133402153002,
        10.624435787434999, 11.846346854850001, 10.716075345704, 14.010440388512002,
        14.78711238678, 14.22020135649, 11.6785343656985, 16.19282325696, 14.94,
        10.60605, 8.800011, 3.461535, 4.875, 2.909088, 4.4, 2.5, 0,
        2.8802169129861857, 0.977990008896, 0, 0.091357, 0.917180657823,
        0.892046835804, 0.8977634012089999, 0.9512697891770001, 0.9278108776450001,
        0.9702973481249998, 0.95053747956, 0.9420016320000001, 0.995490263528,
        0.9524198887724998, 1.005989494128, 0.98218808076, 1.0005360998000001,
        0.99287309748, 0.997333131465, 1.01780398668, 1.0048057747149999,
        0.9928088183139999, 1.0387811238155003, 1.0225819285459998, 1.088813615856,
        0.9694924308160001, 1.107869194959, 2.11267270676, 1.9767699435880002,
        2.108792568105, 2.12367895649, 1.8919773998559999, 2.126909962484,
        2.1859223040355, 2.9668438438820006, 3.2077225552340005, 3.0139532572109995,
        3.12405393756, 3.309467830362, 3.9443639604, 3.354728819664, 3.3683495760975,
        4.2573770974050005, 4.025616243190001, 4.6649888204489995, 4.3371021530575,
        3.5312722079965004, 3.1783357011779994, 3.96174316008, 4.148117343975001,
        4.492512573122, 4.411643062992, 4.205927468232001, 5.122620469449999,
        5.214932461568001, 5.779103214027001, 7.091413058720001, 5.440106756724,
        6.351718103808, 5.778453774, 7.234440092256, 6.881480979969001, 9.048879,
        10.245933871199998, 12.133983846800001, 13.2538810348375, 11.555105194087002,
        13.00107449892, 9.225487391155001, 11.0665593738, 8.163154270711,
        8.965536761038, 4.833339156470499, 5.647056, 3.999998, 5.1,
        2.8571400000000002, 2.333331, 1.75, NA
      ),
      rep(
        c(1L, 11L, 1L, 20L, 1L, 13L, 1L, 2L, 1L, 23L, 1L, 404L),
        c(4L, 1L, 90L, 1L, 79L, 1L, 84L, 1L, 2L, 1L, 76L, 1L)
      )
    ),
    EMI_INT = rep(
      c(
        3.9190441384464276, 10.912073999999999, 11.129766000000002,
        10.394027999999999, 10.610954999999999, 10.46621, 9.917748000000001, 9.040746,
        7.994574000000001, 8.163584, 6.7344, 5.933092, 5.181186, 4.976622, 3.95086,
        3.965871, 4.1644, 5.862875000000001, 7.305924, 8.75338, 11.054475,
        13.013200999999999, 14.206959999999999, 14.213832000000002, 14.244047,
        15.679602, 17.402733, 16.654659000000002, 16.829453, 16.09344, 16.1226,
        13.83021, 13.823625000000002, 14.459959, 14.057775, 13.84372, 12.992,
        12.98375, 12.127658, 11.6564, 11.446695, 10.520171999999999, 10.069613,
        9.89092, 10.098880000000001, 9.952866, 9.44868, 8.115809, 8.01306, 8.430657,
        7.80256, 8.488895, 8.875244, 10.581909, 11.403904, 12.480793, 13.764051,
        15.948258000000001, 18.66696, 19.870088000000003, 18.588758, 18.79166,
        18.949747, 15.121743, 14.472, 22.140077, 16.570988, 11.466078, 11.098416,
        10.438734, 9.17686, 7.385422, 6.161688000000001, 5.204364, 4.34588, 3.959352,
        3.1487999999999996, 2.9724999999999997, 2.0865210000000003, 2.073083,
        2.151948, 2.136465, 1.0642440000000002, 1.175328, 1.110816,
        1.3061340000000001, 1.105572, 1.048432, 1.1773, 0, 5.881324155691066,
        10.929484, 11.127103, 10.409704, 10.896323, 11.675839999999999, 8.86907,
        8.901104, 7.821342, 7.025685, 7.045314, 6.09027, 5.035734, 4.8575669999999995,
        4.07804, 3.756512, 4.275297999999999, 4.814496, 6.309448, 7.979625, 9.143428,
        11.657672, 13.272260000000001, 13.14238, 14.07254, 14.361732, 14.466954,
        15.2048, 14.370495, 14.838824, 13.849409999999999, 13.692288000000001,
        12.975102, 11.968878, 13.004805000000001, 12.601242000000001, 11.381376,
        9.648639, 10.08657, 9.982224, 9.157083, 8.735999999999999, 9.05634, 8.740029,
        8.935008, 8.330714, 9.153268, 8.496864, 8.725615, 8.555456, 9.351161,
        9.983664, 9.842003, 11.41978, 11.915628, 13.512870000000001, 13.86534,
        13.938804, 14.024388, 13.681712000000001, 14.0653, 13.64892, 13.31487,
        12.45083, 13.293557999999999, 10.302000000000001, 8.412690000000001, 6.03141,
        5.024694, 3.165758, 3.0905, 3.144075, 2.066428, 2.005821, 2.147866,
        1.9938600000000002, 2.073825, 1.031754, 1.02525, 1.015365, 1.0492000000000001,
        1.041248, 1.040932, 1.142128, 1.127925, 1.1488, 1.06216, 0,
        1.1376600000000001, 0, 5.751509325655504, 43.879626, 36.582351, 26.459286,
        25.152386, 22.306255, 19.641006, 17.56521, 14.470731, 13.11844,
        11.998695999999999, 10.65311, 9.409988, 7.764046, 7.32963, 6.604764,
        6.0480719999999994, 6.551454, 10.040148, 13.295632, 20.711016,
        25.876817999999997, 30.07174, 32.182908000000005, 36.577863, 40.06612,
        47.001174, 48.606958, 53.741766, 57.906557, 59.590336, 57.783776, 60.043328,
        62.322407999999996, 61.591939999999994, 64.13517399999999, 65.302955,
        62.863451999999995, 60.626107999999995, 62.405616, 59.102692000000005,
        58.520205000000004, 57.620264, 53.335762, 52.602168, 50.413648,
        48.000080000000004, 44.834634, 42.54672, 39.009012, 36.902256,
        34.068509999999996, 32.797401, 31.943345, 32.99049, 32.028372, 33.563469,
        37.07217, 39.154751999999995, 37.829214, 41.139417, 30.894060000000003,
        35.362236, 39.533641, 48.146544, 69.76936, 52.117913, 17.060652, 10.460586,
        8.44301, 7.303030000000001, 5.735008, 5.7636389999999995, 4.275475999999999,
        4.062296, 3.6160479999999997, 3.702517, 2.9074380000000004, 2.356557,
        2.026767, 2.566616, 1.7323549999999999, 1.0633569999999999, 0.965701,
        1.3165499999999999, 0.892316, 1.167628, 1.232332, 1.42197, 0.9732609999999999,
        1.349376, 0, 2.877084184169791, 32.709888, 29.687434, 23.831115,
        23.219839999999998, 23.127027, 21.929985000000002, 18.281073999999997,
        15.381036, 13.088087999999999, 13.788768, 12.762036, 11.719522, 10.925056,
        11.133769, 10.165628, 10.728413999999999, 10.424374, 11.447296, 11.958429,
        11.506176, 13.240779999999999, 15.149479999999999, 18.098817, 19.647801,
        23.369237000000002, 27.588582000000002, 28.545644, 32.126004, 36.241092,
        37.875873, 40.763184, 40.861573, 41.3315, 40.868631, 38.936877, 38.232336,
        36.313140000000004, 34.00058, 31.776392, 29.880216, 28.48001, 27.123852,
        25.80362, 24.928902, 22.481576, 21.818160000000002, 19.346183999999997,
        19.529965999999998, 16.920615, 15.795482, 15.807204, 14.903094, 14.158232,
        15.949536, 17.35968, 19.753056, 25.682228000000002, 28.116127000000002,
        31.21472, 34.114824, 30.62243, 31.312692000000002, 27.98914, 31.947409,
        19.095039, 16.336906, 10.858334, 8.245561, 6.344454, 5.941325, 5.18313,
        4.492944, 4.413288, 4.201054, 4.09752, 4.169331, 3.8479799999999997, 4.262544,
        3.622374, 3.8132379999999997, 2.884725, 2.412306, 2.575156,
        2.2600000000000002, 1.8603999999999998, 2.20504, 2.652975, 2.100042, 1.62792,
        1.02383, 1.5849119999999999, 1.0192430000000001, 1.793116, 1.2083430000000002,
        0, NA
      ),
      rep(
        c(1L, 12L, 1L, 12L, 1L, 10L, 1L, 6L, 404L),
        c(89L, 1L, 89L, 1L, 91L, 1L, 95L, 1L, 1L)
      )
    ),
    EMI_NAT = rep(
      c(
        21.55474276145535, 50.588316000000006, 54.639063, 46.298664, 41.55633,
        40.822915, 33.723708, 29.135061999999998, 24.982692, 21.426944000000002,
        19.23996, 16.81234, 15.546459, 12.939777000000001, 11.85258, 10.90401,
        11.450664, 14.658567, 24.003969, 35.016225, 50.252669999999995, 67.07208,
        85.233468, 104.57436, 122.092598, 136.506942, 160.710108, 161.64208200000002,
        163.339492, 158.10624, 155.862954, 132.36193, 121.63930500000001, 118.57726,
        109.440375, 97.90176, 88.94648, 79.90125, 72.75944, 66.05186,
        62.42808000000001, 56.430431999999996, 55.38120599999999, 51.4394, 49.487856,
        45.777886, 44.092731, 40.575876, 38.059692, 35.824833999999996, 33.16088,
        33.00866, 33.53156, 32.708312, 32.312191999999996, 33.605704, 33.423264,
        32.837985, 34.38396, 33.775868, 32.28878, 32.637480000000004, 31.584334,
        29.238342, 36.18, 49.549749000000006, 23.819873, 22.932156,
        21.185399999999998, 19.830885, 18.356965, 17.936933999999997, 16.431168,
        15.610155, 14.121288, 12.870492, 12.595199999999998, 11.889999999999999,
        11.472081, 11.400747, 10.75974, 9.610839, 8.515982999999999,
        8.223479999999999, 6.669768, 5.223075, 4.423407, 4.19474, 3.530935, 2.4887,
        2.196447, 2.376, 1.33623, 1.1593259999999999, 1.319974, 1.320956, 0,
        22.541628495122303, 65.581616, 54.623098, 44.477399999999996,
        39.042474000000006, 36.09144, 28.5784, 24.723840000000003, 21.510008999999997,
        19.070487, 17.108129, 15.221670000000001, 14.096898, 13.598052000000001,
        14.275830000000001, 14.086920000000001, 18.171421, 22.148784, 33.651299,
        48.869040000000005, 72.13784799999999, 100.068514, 133.74009600000002,
        158.72070399999998, 178.910254, 190.526721, 201.55803, 203.738816,
        189.68618999999998, 181.018916, 163.233375, 144.750768, 127.740501,
        110.467344, 103.03286400000002, 88.208694, 79.65966, 67.540473, 62.54406,
        55.899134000000004, 50.878195, 46.59525, 45.285047999999996, 42.728661,
        41.69442, 40.611368, 37.637098, 36.118188, 33.927154, 34.215496, 35.327348,
        32.949936, 32.484707, 32.35224, 32.995806, 35.709114, 35.650965,
        35.308507999999996, 37.060245, 36.15821, 36.1673, 35.096000000000004,
        35.84874, 33.199356, 39.876543, 36.05296, 28.391358, 26.13238, 25.116048,
        24.273273999999997, 21.623, 20.954835000000003, 18.601096000000002, 18.046111,
        17.186059, 14.94812, 14.525549999999999, 13.404345, 12.311202, 11.17701,
        10.478885, 10.412479999999999, 9.358772, 7.992584, 6.769575,
        5.745794999999999, 5.309238000000001, 4.390935, 3.4129799999999997, 3.081648,
        2.4121409999999996, 2.20632, 1.2369700000000001, 1.144474, 1.31544, 1.215375,
        0, 6.710838745216295, 28.57239, 25.962009, 19.403874000000002,
        19.347209000000003, 18.25089, 15.712575, 14.636700000000001, 13.437193,
        11.24388, 10.908017999999998, 8.715665, 8.363392, 6.7943810000000004,
        6.283200000000001, 5.50397, 5.0400599999999995, 6.551454, 11.155248, 15.95552,
        27.614687999999997, 37.737117000000005, 44.58948, 51.113572,
        60.643086000000004, 67.34486199999999, 80.842872, 86.412518, 94.730922,
        101.80464400000001, 104.281346, 99.72191600000001, 101.323116, 102.247826,
        98.54628, 98.088706, 96.93447, 90.238014, 84.30752, 83.891136,
        78.13611300000001, 75.10158000000001, 74.383036, 69.13861800000001, 67.774296,
        65.846168, 61.56456, 58.081278000000005, 55.310325000000006, 50.301552,
        47.44522, 44.39295, 40.996319, 37.932195, 36.18459, 32.028372, 29.614916,
        28.834083, 26.103168000000004, 23.514684, 22.074378, 20.240784, 17.681118,
        14.683425000000002, 12.316223999999998, 10.260316, 10.169302, 6.398028,
        5.811673, 4.2212, 4.17316, 3.440894, 2.305359, 2.1377379999999997, 2.030952,
        1.8080239999999999, 1.2340300000000002, 0.9691460000000001, 1.1781,
        1.0132320000000001, 1.283308, 0.866061, 1.0633569999999999, 0.965701, 0,
        4.795849384998738, 27.598464, 23.979179000000002, 18.866505, 16.968574,
        17.344992, 15.664109999999999, 13.203428, 12.304611, 10.283346,
        10.606831999999999, 8.834679, 8.523983000000001, 6.95296, 6.679849000000001,
        5.544888, 5.3637060000000005, 7.297342, 12.487551999999999, 21.742833,
        30.682872, 41.758430000000004, 49.488031, 53.342487, 57.073629, 60.585943,
        68.051211, 69.579512, 72.284778, 75.34467, 72.97997699999999, 71.819772,
        67.46957300000001, 64.81475, 62.798004000000006, 57.931523999999996, 56.34384,
        51.033996, 47.999412, 44.687046, 42.82938, 40.68688, 38.17387,
        36.720611999999996, 35.314951, 33.722364000000006, 32.728176,
        29.019275999999998, 30.37975, 27.497429999999998, 25.668238,
        26.346383999999997, 24.483336, 22.652891999999998, 23.391864,
        21.700991000000002, 19.753056, 19.261022, 17.070549, 15.60736, 14.305842,
        11.85398, 10.064832000000001, 7.83673, 6.389823, 5.025474, 3.500424, 3.257227,
        2.355605, 2.11464, 1.98061, 2.07315, 2.246472, 2.206644, 1.050462, 1.02438,
        1.042425, 0.961818, 1.4208479999999999, 0.9057230000000001,
        1.2709840000000001, 0.96165, 0, 0.85845, 0, NA
      ),
      rep(
        c(1L, 5L, 1L, 5L, 1L, 17L, 1L, 17L, 404L),
        c(96L, 1L, 96L, 1L, 84L, 1L, 84L, 1L, 1L)
      )
    ),
    IMM_INT = rep(
      c(
        5, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 6, 8, 9, 11, 12, 13, 14, 13,
        12, 11, 10, 9, 8, 9, 10, 11, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 4, 15,
        14, 13, 12, 11, 10, 9, 8, 7, 6, 7, 6, 7, 8, 9, 10, 11, 12, 13, 14, 13, 12, 11,
        10, 9, 8, 7, 6, 7, 6, 5, 4, 3, 2, 1, 0, 14, 55, 53, 51, 49, 47, 46, 45, 44,
        43, 42, 40, 38, 40, 47, 58, 72, 89, 107, 124, 138, 149, 158, 163, 165, 163,
        159, 154, 147, 140, 134, 127, 120, 114, 107, 101, 95, 90, 85, 80, 75, 71, 67,
        64, 60, 57, 53, 50, 46, 43, 38, 34, 29, 25, 22, 19, 16, 13, 11, 9, 8, 7, 6, 5,
        4, 3, 2, 1, 0, 18, 57, 53, 50, 48, 46, 45, 44, 42, 41, 40, 38, 37, 35, 33, 31,
        30, 37, 51, 72, 93, 113, 127, 136, 140, 137, 132, 126, 119, 112, 105, 98, 92,
        86, 81, 76, 71, 67, 63, 59, 55, 52, 49, 47, 44, 42, 40, 38, 36, 34, 32, 29,
        27, 23, 21, 18, 15, 13, 12, 10, 8, 7, 6, 5, 4, 3, 2, 1, 0, NA
      ),
      rep(
        c(
          1L, 2L, 1L, 2L, 1L, 2L, 3L, 1L, 9L, 2L, 3L, 2L, 4L, 2L, 1L, 2L, 3L, 1L, 3L,
          1L, 3L, 4L, 6L, 10L, 1L, 2L, 1L, 2L, 1L, 5L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 7L,
          2L, 1L, 2L, 1L, 3L, 4L, 5L, 8L, 6L, 4L, 5L, 7L, 9L, 6L, 1L, 2L, 1L, 2L, 1L,
          2L, 1L, 2L, 1L, 2L, 6L, 21L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 4L, 12L, 7L, 8L,
          404L
        ),
        c(
          2L, 1L, 1L, 1L, 7L, 1L, 1L, 6L, 1L, 1L, 2L, 2L, 1L, 1L, 1L, 2L, 1L, 1L, 1L,
          1L, 4L, 2L, 1L, 1L, 1L, 1L, 6L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 1L,
          1L, 2L, 1L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 5L, 1L, 1L, 2L, 3L,
          1L, 11L, 1L, 40L, 2L, 1L, 1L, 10L, 1L, 5L, 1L, 7L, 1L, 38L, 2L, 1L, 1L, 1L,
          1L, 1L
        )
      )
    ),
    IMM_NAT = rep(
      c(
        51, 94, 84, 73, 64, 50, 41, 34, 30, 26, 23, 21, 19, 18, 17, 16, 18, 20, 25,
        35, 50, 68, 88, 103, 121, 128, 138, 147, 155, 156, 155, 154, 148, 137, 124,
        114, 101, 93, 83, 78, 69, 65, 59, 56, 52, 47, 46, 43, 42, 41, 40, 39, 38, 39,
        37, 38, 35, 34, 35, 36, 29, 25, 22, 18, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5,
        4, 3, 2, 1, 0, 57, 85, 76, 67, 62, 46, 39, 33, 27, 23, 20, 18, 15, 14, 13, 15,
        20, 33, 51, 72, 96, 115, 138, 157, 182, 186, 184, 181, 169, 160, 152, 146,
        135, 125, 113, 103, 91, 84, 76, 68, 61, 56, 49, 46, 42, 39, 38, 37, 39, 40,
        41, 43, 42, 43, 42, 41, 42, 40, 38, 37, 33, 29, 25, 21, 19, 17, 16, 15, 14,
        12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 1, 19, 35, 28, 26, 22, 21, 20, 19,
        18, 16, 15, 13, 12, 14, 17, 23, 31, 40, 49, 61, 74, 92, 104, 114, 124, 130,
        133, 135, 138, 139, 137, 135, 128, 127, 117, 112, 106, 98, 91, 86, 80, 77, 69,
        65, 59, 55, 49, 47, 41, 39, 36, 34, 32, 30, 26, 25, 22, 20, 17, 14, 12, 9, 7,
        5, 3, 2, 1, 0, 20, 42, 33, 29, 27, 23, 20, 18, 16, 14, 12, 11, 9, 8, 7, 6, 7,
        9, 13, 21, 33, 42, 52, 61, 70, 81, 88, 95, 102, 104, 103, 97, 96, 90, 84, 80,
        74, 69, 63, 58, 54, 50, 44, 41, 39, 36, 33, 32, 31, 30, 28, 27, 26, 25, 24,
        23, 21, 19, 17, 15, 14, 13, 11, 9, 8, 7, 5, 4, 3, 2, 1, 0, NA
      ),
      rep(
        c(
          1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 3L, 4L, 3L, 5L,
          1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 5L, 2L, 1L, 2L,
          1L, 2L, 3L, 1L, 2L, 1L, 2L, 8L, 6L, 15L, 1L, 2L, 1L, 2L, 1L, 9L, 8L, 13L,
          404L
        ),
        c(
          15L, 1L, 12L, 1L, 19L, 1L, 1L, 1L, 1L, 2L, 16L, 3L, 1L, 1L, 1L, 1L, 1L, 1L,
          1L, 14L, 1L, 10L, 1L, 20L, 1L, 8L, 2L, 12L, 3L, 1L, 1L, 1L, 4L, 1L, 1L, 1L,
          4L, 1L, 7L, 1L, 1L, 47L, 1L, 2L, 2L, 1L, 1L, 1L, 64L, 1L, 2L, 1L, 1L, 1L, 1L,
          1L, 1L
        )
      )
    ),
    ACQ = rep(
      c(
        0, 0.9582126216334801, 16.32708, 16.521705, 14.111818, 16.445184, 18.25089,
        18.658611, 19.51677, 22.740234, 24.36232, 30.54146, 31.958195,
        37.63760799999999, 42.704494999999994, 49.21570500000001, 48.434936,
        45.362544, 44.926812000000005, 41.275692, 20.38708, 17.752146, 17.251938,
        14.51774, 11.358788, 11.550525, 10.229261, 10.340484, 10.801398, 10.931232,
        11.208403, 11.918764, 13.048006, 14.073596, 16.553512, 18.0044,
        21.692172000000003, 24.488319999999998, 25.348239, 27.47124, 29.668128,
        30.052528000000002, 31.212, 33.525544000000004, 31.605712, 32.37039,
        31.894623999999997, 30.260065, 29.550528, 28.718625, 25.664688,
        23.195649999999997, 21.68061, 20.497294999999998, 18.966941, 18.09145,
        16.531080000000003, 14.807458, 14.416262999999999, 13.051584000000002,
        12.269382, 12.040302, 10.653276, 9.945026, 7.907227000000001, 6.71784,
        5.130158, 5.084651, 3.1986360000000005, 3.486862, 2.1106, 2.08658, 2.294114,
        1.1529209999999999, 1.0688689999999998, 1.015672, 0.9040119999999999,
        1.2340300000000002, 0.9691460000000001, 1.1781, 1.0132320000000001, 1.283308,
        0.866061, 1.0633569999999999, 0, 0.9593826004144738, 23.510016, 21.69475,
        16.880661, 16.075962, 17.344992, 17.753505, 18.281073999999997,
        19.483299000000002, 23.371433999999997, 27.577536, 31.413501,
        35.159656999999996, 38.734848, 44.536107, 44.359104, 50.421642, 45.865938,
        40.585216, 32.613819, 26.847216, 23.42536, 19.189071000000002, 17.145656,
        14.969994, 13.84837, 11.954844, 10.704192, 9.816984, 11.444256, 12.010005,
        15.528293999999999, 19.006427, 20.66575, 24.919488, 27.541584, 30.183216,
        30.423624, 31.999608000000002, 34.755927, 34.86159, 35.60102, 35.158788,
        33.742892000000005, 34.27575, 32.700822, 31.636799999999997, 28.051452,
        26.040546, 24.323895, 21.719754000000002, 21.076794, 19.160484, 16.98932,
        15.949536, 13.01976, 11.85209, 10.700712, 9.03685, 8.324328000000001,
        7.703235, 5.92699, 5.592048, 4.477995, 3.1944850000000002, 3.014964, 2.333616,
        2.17194, 1.178117, 1.05732, 0.990305, 1.0368300000000001, 1.123236, 0, NA
      ),
      rep(c(202L, 1L, 18L, 1L, 28L, 404L), c(1L, 83L, 1L, 73L, 1L, 1L))
    ),
    MIG_SUB = numeric(808)
  )

  # run complement_projection
  output_table <- complement_projection(empty_df, raw_df, subregional = TRUE)

  # run tests
  expect_snapshot(constructive::construct(output_table))
})
